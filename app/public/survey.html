<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>FriendSurvey</title>
    <!--BOOTSTRAP CSS-->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <!--JQUERY CDN-->
    <script
  src="https://code.jquery.com/jquery-3.4.1.js"
  integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU="
  crossorigin="anonymous"></script>
  <!-- <script type="text/javascript" src="../data/friends.js"></script> -->
</head>
<body>
    <a href='/home'><button type="submit" class="btn btn-primary" id='homebutton'>Home</button></a>


  
  <!-- Modal -->
  <div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalCenterTitle"></h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          ...
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

    <!--START OF FORM-->
    <form class='col-sm-10 offset-sm-1'>
        <div class="form-group">
            <label for="nameInput">Name</label>
            <input type="name" class="form-control" id="nameInput" placeholder="Name">
        </div>
        <div class="form-group">
            <label for="photoInput">Photo Link</label>
            <input type="photo" class="form-control" id="photoInput" placeholder="Photo">
        </div>


  
        <!--DROPDOWN QUESTION 1-->
        <h3>Question 1:</h3>
        <p>I prefer to spend my weekends at home watching movies.</p>
        <div class="input-group mb-3">
            <div class="input-group-prepend">
                <label class="input-group-text" for="q1">Question 1</label>
            </div>
            <select class="custom-select" id="q1">
                <option selected>Choose...</option>
                <option value="1">One - disagree</option>
                <option value="2">Two</option>
                <option value="3">Three</option>
                <option value="4">Four</option>
                <option value="5">Five - strongly agree</option>
            </select>
        </div>

        <!--DROPDOWN QUESTION 2-->
        <h3>Question 2:</h3>
        <p>I enjoy outdoor activities like hiking and swimming.</p>
        <div class="input-group mb-3">
            <div class="input-group-prepend">
                <label class="input-group-text" for="q2">Question 2</label>
            </div>
            <select class="custom-select" id="q2">
                <option selected>Choose...</option>
                <option value="1">One - disagree</option>
                <option value="2">Two</option>
                <option value="3">Three</option>
                <option value="4">Four</option>
                <option value="5">Five - strongly agree</option>
            </select>
        </div>

        <!--DROPDOWN QUESTION 3-->
        <h3>Question 3:</h3>
        <p>I am adventurous when it comes to trying new foods.</p>
        <div class="input-group mb-3">
            <div class="input-group-prepend">
                <label class="input-group-text" for="q3">Question 3</label>
            </div>
            <select class="custom-select" id="q3">
                <option selected>Choose...</option>
                <option value="1">One - disagree</option>
                <option value="2">Two</option>
                <option value="3">Three</option>
                <option value="4">Four</option>
                <option value="5">Five - strongly agree</option>
            </select>
        </div>

        <!--DROPDOWN QUESTION 4-->
        <h3>Question 4:</h3>
        <p>I am an animal lover.</p>
        <div class="input-group mb-3">
            <div class="input-group-prepend">
                <label class="input-group-text" for="q4">Question 4</label>
            </div>
            <select class="custom-select" id="q4">
                <option selected>Choose...</option>
                <option value="1">One - disagree</option>
                <option value="2">Two</option>
                <option value="3">Three</option>
                <option value="4">Four</option>
                <option value="5">Five - strongly agree</option>
            </select>
        </div>

        <!--DROPDOWN QUESTION 5-->
        <h3>Question 5:</h3>
        <p>I like working in groups more than working alone.</p>
        <div class="input-group mb-3">
            <div class="input-group-prepend">
                <label class="input-group-text" for="q5">Question 5</label>
            </div>
            <select class="custom-select" id="q5">
                <option selected>Choose...</option>
                <option value="1">One - disagree</option>
                <option value="2">Two</option>
                <option value="3">Three</option>
                <option value="4">Four</option>
                <option value="5">Five - strongly agree</option>
            </select>
        </div>

        <!--DROPDOWN QUESTION 6-->
        <h3>Question 6:</h3>
        <p>The best vacation is at a tropical beach.</p>
        <div class="input-group mb-3">
            <div class="input-group-prepend">
                <label class="input-group-text" for="q6">Question 6</label>
            </div>
            <select class="custom-select" id="q6">
                <option selected>Choose...</option>
                <option value="1">One - disagree</option>
                <option value="2">Two</option>
                <option value="3">Three</option>
                <option value="4">Four</option>
                <option value="5">Five - strongly agree</option>
            </select>
        </div>

        <!--DROPDOWN QUESTION 7-->
        <h3>Question 7:</h3>
        <p>I want a large family.</p>
        <div class="input-group mb-3">
            <div class="input-group-prepend">
                <label class="input-group-text" for="q7">Question 7</label>
            </div>
            <select class="custom-select" id="q7">
                <option selected>Choose...</option>
                <option value="1">One - disagree</option>
                <option value="2">Two</option>
                <option value="3">Three</option>
                <option value="4">Four</option>
                <option value="5">Five - strongly agree</option>
            </select>
        </div>

        <!--DROPDOWN QUESTION 8-->
        <h3>Question 8:</h3>
        <p>I prefer comedy over horror.</p>
        <div class="input-group mb-3">
            <div class="input-group-prepend">
                <label class="input-group-text" for="q8">Question 8</label>
            </div>
            <select class="custom-select" id="q8">
                <option selected>Choose...</option>
                <option value="1">One - disagree</option>
                <option value="2">Two</option>
                <option value="3">Three</option>
                <option value="4">Four</option>
                <option value="5">Five - strongly agree</option>
            </select>
        </div>

        <!--DROPDOWN QUESTION 9-->
        <h3>Question 9:</h3>
        <p>I think it's important to be well travelled.</p>
        <div class="input-group mb-3">
            <div class="input-group-prepend">
                <label class="input-group-text" for="q9">Question 9</label>
            </div>
            <select class="custom-select" id="q9">
                <option selected>Choose...</option>
                <option value="1">One - disagree</option>
                <option value="2">Two</option>
                <option value="3">Three</option>
                <option value="4">Four</option>
                <option value="5">Five - strongly agree</option>
            </select>
        </div>

        <!--DROPDOWN QUESTION 10-->
        <h3>Question 10:</h3>
        <p>I am money motivated.</p>
        <div class="input-group mb-3">
            <div class="input-group-prepend">
                <label class="input-group-text" for="q10">Question 10</label>
            </div>
            <select class="custom-select" id="q10">
                <option selected>Choose...</option>
                <option value="1">One - disagree</option>
                <option value="2">Two</option>
                <option value="3">Three</option>
                <option value="4">Four</option>
                <option value="5">Five - strongly agree</option>
            </select>
        </div>

        <button type="submit" class="btn btn-primary" id='submitbutton' data-toggle="modal" data-target="#exampleModalCenter">Submit</button>
    </form>










<!--BOOTSTRAP JS-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>

<!--My JS-->
<script>
    // const path = require('path');
    // const friends = require('./friends');
    $("#submitbutton").on('click', function(event){
        event.preventDefault();
        var newUser = {
            "name": $("#nameInput").val().trim(),
            "photoLink": $("#photoInput").val().trim(),
            "responses": [
                $("#q1").val(),
                $("#q2").val(),
                $("#q3").val(),
                $("#q4").val(),
                $("#q5").val(),
                $("#q6").val(),
                $("#q7").val(),
                $("#q8").val(),
                $("#q9").val(),
                $("#q10").val()
            ]
        }
        // console.log(newUser);
        var currentURL = window.location.origin;
        $.post(currentURL + "/api/friends", newUser, function(data){
            // console.log("friends object: ", data);
            data.forEach(element => {
                const responseArrays = element.responses;
                const numericArray = [];
                responseArrays.forEach(element => {
                    numericArray.push(parseInt(element));
                });
                //the last portion of this hw I need to complete is comparing the responses from each user by iterating over their arrays and finding the difference between their responses to question 1, question 2, question3... Then we need to sum those differences to generate a 'total difference' score. Once this is done I need to compare total differences across all users to find the smallest total difference and return that user as a match.
                
            });
            // console.log(data);
        });
        // findMath(newUser.name);


        
        $.ajax({
            'url': currentURL + "/api/friends",
            'method': 'GET'
        }).then(function(response){
            let friends = response;

            //FIND MATCH FUNCTION
            function findMatch(name) {
            let currentUser;
            friends.forEach(function(element){
                if (element.name === name){
                    currentUser = element;
                }
            });
            let currentUserScores=[];
            currentUser.responses.forEach(function(element){
                currentUserScores.push(parseInt(element));
            });
            //   console.log(currentUserScores);
            //now compare current user scores to all other friends' scores



            //set least diff at max possible total diff
            let leastDiff=50;
            
            friends.forEach(function(element){
                

                if (element.name !== name) {
                    let comparisonArray = element.responses;
                    //for each comparison array i need to subtract current user responses to get a total difference
                    let totalDiff = 0;
                    for (let i = 0; i < currentUserScores.length; i++) {
                        //abs val
                        totalDiff= totalDiff + (Math.abs(currentUserScores[i]-comparisonArray[i]));
                    }
                    // console.log(element.name + totalDiff);
                    if (totalDiff < leastDiff) {
                        leastDiff = totalDiff;
                    }


                    //find least diff and return that user
                }

            })
            // console.log(leastDiff);
            friends.forEach(function(element){
                if (element.name !== name){
                    let comparisonArray = element.responses;
                    let totalDiff = 0;
                    for (let i = 0; i < currentUserScores.length; i++) {
                        totalDiff = totalDiff + (Math.abs(currentUserScores[i]-comparisonArray[i]));
                    }
                    if (leastDiff === totalDiff) {
                        console.log(element.name);
                        $("#exampleModalCenterTitle").text("You're new friend is: " + element.name + "!");
                        let picDiv = $("<div>");
                        let pic = $("<img>");
                        pic.attr('src', element.photo);
                        picDiv.append(pic);    
                        $(".modal-body").append(picDiv);
                    }
                }

            });
            
            

    }

        findMatch(newUser.name);
        // console.log(newUser.name);

        //END OF FIND MATCH FUNCTION

            
        })






    });
  
</script>
</body>
</html>